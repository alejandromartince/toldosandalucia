#!/bin/bash

# Nombre de las ramas
MAIN_BRANCH="v2"
DEPLOY_BRANCH="produccion"

# Ejecutar build
echo "ðŸ“¦ Construyendo el proyecto..."
npm run build

# Clonar el repo temporalmente en /tmp
echo "ðŸ“‚ Preparando rama $DEPLOY_BRANCH..."
rm -rf /tmp/deploy-temp
git clone . /tmp/deploy-temp
cd /tmp/deploy-temp

# Crear rama de despliegue o cambiar a ella
git checkout $DEPLOY_BRANCH 2>/dev/null || git checkout --orphan $DEPLOY_BRANCH

# Eliminar todo
git rm -rf . > /dev/null 2>&1

# Copiar el contenido del build (ajusta si usas otro directorio)
cp -r ../dist/* .
cp ../dist/.htaccess . 2>/dev/null # si usas htaccess

# AÃ±adir archivos
git add .

# Commit
git commit -m "ðŸš€ Deploy automÃ¡tico desde $MAIN_BRANCH - $(date)" --allow-empty

# Push forzado
git push origin $DEPLOY_BRANCH --force

# Limpiar
cd ..
rm -rf /tmp/deploy-temp

echo "âœ… Â¡Despliegue a $DEPLOY_BRANCH completado!"
